console.log("Hola mundo!");

var B = 3975;
var mraa = require("mraa");
var fs = require('fs');

var myAnalogPin = new mraa.Aio(0);
var myDigitalPin = new mraa.Gpio(5);

var ledOn = false;


setInterval(function() {
        
        var tempActual = getTempActual();
        var tempLimite = 30;
        
        var lcd = require('./lcd');
        var display = new lcd.LCD(0);
        
        console.log("tempActual: " + (tempActual));
        console.log("tempLimite: " + (tempLimite));
        console.log("comparacion: " + (tempActual < tempLimite));
        
        if (tempActual < tempLimite) {
            display.setColor(0, 0, 255);
            display.setCursor(0, 0);
            display.write('ESTABLE:');
            display.setCursor(1,0);
            myDigitalPin.write(0);
        }
        else {
            display.setColor(255, 0, 0);
            display.setCursor(0, 0);
            display.write('ALERTA:');
            display.setCursor(1,0);
            ledOn ? myDigitalPin.write(0) : myDigitalPin.write(1);
            ledOn = !ledOn;
        }

        display.write(tempActual.toString());
        //console.log("Temperature: " + tempActual);
        
    }, 3000);


function getTempActual() {
    var a = myAnalogPin.read();
    //console.log("Analog Pin (A0) Output: " + a);
    var resistance = (1023 - a) * 10000 / a;
    var celsius_temperature = 1 / (Math.log(resistance / 10000) / B + 1 / 298.15) - 273.15;//convert temperature via datasheet ;
    
    return Math.round(celsius_temperature * 100) / 100;
}